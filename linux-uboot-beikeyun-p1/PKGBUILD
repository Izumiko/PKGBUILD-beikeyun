# PKGBUILD Maintainer: Izumiko <yosoro@outlook.com>

_debver=5.98
_imagename=linux-u-boot-rock64_${_debver}_arm64.deb

pkgname=linux-uboot-beikeyun-p1
pkgver=${_debver}
pkgrel=1
pkgdesc="U-Boot loader and files for Beikeyun P1. This package will fetch a Debian built uboot from armbian."
arch=('aarch64')
url="https://apt.armbian.com/pool/main/l/linux-u-boot-rock64-default/"
license=('GPL')
options=('!strip')
optdepends=('uboot-tools')
provides=("uboot-beikeyun-p1=${pkgver}")
conflicts=('uboot-rock64')
install=${pkgname}.install
backup=('boot/extlinux/extlinux.conf')
source=("https://apt.armbian.com/pool/main/l/linux-u-boot-rock64-default/${_imagename}"
        'linux-uboot-beikeyun-p1.install'
        'extlinux.conf')
md5sums=('020521f15f74998bace70e6aca9a3f39'
         '10ec1093213bbe73204f10e8fd695841'
         'c807bf9bcf3c539e6cad8f57d408f583')
noextract=("${_imagename}")


prepare() {
  cd "${srcdir}"

  # extract the prebuilt kernel files
  ar xf "${_imagename}"
  tar xf data.tar.xz
}

package() {
  cd "${srcdir}"

  # copy extlinux config
  mkdir -p "${pkgdir}/boot/extlinux"
  cp extlinux.conf ${pkgdir}/boot/extlinux/
  
  # copy uboot image files
  cp usr/lib/linux-u-boot-rock64_*_arm64/* "${pkgdir}/boot/"

}

